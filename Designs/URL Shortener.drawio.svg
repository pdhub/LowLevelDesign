<?xml version="1.0" encoding="UTF-8"?>
<!-- Do not edit this file with editors other than diagrams.net -->
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="782px" height="557px" viewBox="-0.5 -0.5 782 557" content="&lt;mxfile host=&quot;app.diagrams.net&quot; modified=&quot;2022-09-29T07:10:23.508Z&quot; agent=&quot;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/105.0.0.0 Safari/537.36 Edg/105.0.1343.42&quot; etag=&quot;hRGMpallriixNx3OBQpA&quot; version=&quot;20.3.7&quot; type=&quot;github&quot;&gt;&lt;diagram id=&quot;52mfMfOLr4s_mTMX_dyX&quot; name=&quot;Page-1&quot;&gt;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&lt;/diagram&gt;&lt;/mxfile&gt;" resource="https://app.diagrams.net/#Hpdhub%2FLowLevelDesign%2Fmaster%2FDesigns%2FURL%20Shortener.drawio.svg"><defs/><g><path d="M 490.63 135 L 601.63 135" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 606.88 135 L 599.88 138.5 L 601.63 135 L 599.88 131.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 447.76 165 L 447.8 212.5 L 447.76 253.63" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 447.75 258.88 L 444.26 251.88 L 447.76 253.63 L 451.26 251.89 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><ellipse cx="447.76" cy="135" rx="42.875" ry="30" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 84px; height: 1px; padding-top: 135px; margin-left: 406px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">KGS</div></div></div></foreignObject><text x="448" y="139" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">KGS</text></switch></g><path d="M 610 120 C 610 111.72 621.42 105 635.5 105 C 642.26 105 648.75 106.58 653.53 109.39 C 658.31 112.21 661 116.02 661 120 L 661 160 C 661 168.28 649.58 175 635.5 175 C 621.42 175 610 168.28 610 160 Z" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 661 120 C 661 128.28 649.58 135 635.5 135 C 621.42 135 610 128.28 610 120" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 49px; height: 1px; padding-top: 153px; margin-left: 611px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">KGS DB</div></div></div></foreignObject><text x="636" y="156" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">KGS DB</text></switch></g><rect x="0" y="15" width="350" height="530" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 348px; height: 1px; padding-top: 280px; margin-left: 2px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><ul><li>Generate URL's and Save to DB.</li><li>Load some URL's and put to cache. Marking those URL's as used in DB.</li><li>User requests URL, gets from Cache. And then do write to DB from Cache.</li><li>Assumption is Write is Less. Read is more.</li><li>What if DB write fails ?</li><li>What happens when Read traffic more ? We cant hog the DB for Read.</li><li>How to copy URL's to Cache, what strategy?</li><li>Non functional requirement to expire links and also add custom links</li></ul><div><br /></div><div>Flow :</div><div><ul><li>Talk about the API first -&gt; add the clientId -&gt; Rate Limiter things</li><li>DataBase Design. DataBase Schema. Data is small, and millions of records without relationships. Go with NoSql (Will deal which one later)</li><li>KGS should keep two tables, one for used for for non used. Once KGS gives a set of keys to a server it has to mark those keys as used in the DB. Synchronized lock should be used while transferring keys from non used to used, in case KGS dies. </li><li>KGS will keep some keys in memory for fast reads.</li><li>KGS needs copy as it can be SPOF.</li><li>If app server initially reads from KGS into cache, acceptable, but if app server dies before reading, waste of keys. </li><li>URL sharded by hash of Key. If we hash by range we will have unbalanced DB. Along with has we will add consistent hashing. </li><li>Question on Read and Write flows in Cassandra.</li><li>Cache Replica, Cache eviction.</li><li>Clean up service to clean from DB and cache.</li></ul></div></div></div></div></foreignObject><text x="2" y="284" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px">Generate URL's and Save to DB.Load some URL's and put to c...</text></switch></g><ellipse cx="447.75" cy="406.25" rx="6.75" ry="6.25" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><path d="M 447.75 412.5 L 447.75 433.33 M 447.75 416.67 L 434.25 416.67 M 447.75 416.67 L 461.25 416.67 M 447.75 433.33 L 434.25 450 M 447.75 433.33 L 461.25 450" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 457px; margin-left: 448px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: nowrap;">Actor</div></div></div></foreignObject><text x="448" y="469" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">Actor</text></switch></g><path d="M 447.75 300 L 447.8 350 L 447.97 393.63" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 448 398.88 L 444.47 391.9 L 447.97 393.63 L 451.47 391.87 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 487.5 280 L 507.5 280 L 480 280 L 493.63 280" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 498.88 280 L 491.88 283.5 L 493.63 280 L 491.88 276.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><ellipse cx="447.75" cy="280" rx="39.75" ry="20" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 280px; margin-left: 409px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">App Server</div></div></div></foreignObject><text x="448" y="284" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">App Server</text></switch></g><path d="M 621.75 250 C 621.75 241.72 637.87 235 657.75 235 C 667.3 235 676.45 236.58 683.21 239.39 C 689.96 242.21 693.75 246.02 693.75 250 L 693.75 310 C 693.75 318.28 677.63 325 657.75 325 C 637.87 325 621.75 318.28 621.75 310 Z" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 693.75 250 C 693.75 258.28 677.63 265 657.75 265 C 637.87 265 621.75 258.28 621.75 250" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 70px; height: 1px; padding-top: 293px; margin-left: 623px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">URL sharded by hash of key</div></div></div></foreignObject><text x="658" y="296" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">URL sharded...</text></switch></g><path d="M 525 267.5 C 505 267.5 500 280 516 282.5 C 500 288 518 300 531 295 C 540 305 570 305 580 295 C 600 295 600 285 587.5 280 C 600 270 580 260 562.5 265 C 550 257.5 530 257.5 525 267.5 Z" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 98px; height: 1px; padding-top: 280px; margin-left: 501px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Cache</div></div></div></foreignObject><text x="550" y="284" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">Cache</text></switch></g><path d="M 730.5 60 L 730.5 280 L 700.12 280" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 694.87 280 L 701.87 276.5 L 700.12 280 L 701.87 283.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><ellipse cx="730.5" cy="30" rx="50.5" ry="30" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 99px; height: 1px; padding-top: 30px; margin-left: 681px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Cache clean up for expired entries</div></div></div></foreignObject><text x="731" y="34" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">Cache clean up fo...</text></switch></g></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://www.diagrams.net/doc/faq/svg-export-text-problems" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">Text is not SVG - cannot display</text></a></switch></svg>